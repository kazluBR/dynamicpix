const SVG_LIB="http://www.w3.org/2000/svg",MIN_DIMENSION=3,MAX_WIDTH_DIMENSION=125,MAX_HEIGTH_DIMENSION=50,TRANSLATE_X=10,TRANSLATE_Y=10,LINE_COLOR="#808080",RULE_COLOR="#ff00ff",ARROW_COLOR="#ff00ff",CALCULATED_EMPTY_COLOR="#808080";class editor{constructor(t={}){this.size=t.size||20,this.width=t.width||5,this.height=t.height||5,this.gridLength=t.gridLength||5,this.currentColor=t.currentColor||"#000000",this.backgroundColor=t.backgroundColor||"#ffffff",this.clicked=!1,this.states=[],this.currentKey=0,this.squareI=null,this.squareJ=null,this.colorSquare=null,document.body.onmousedown=function(t){if(1==t.button)return!1},document.body.onmouseup=(()=>this.endColorsChange())}init(){this.createSvgDocument(),this.createBackground();for(let t=0;t<=this.width;t++)this.createLine(0,t);for(let t=0;t<=this.height;t++)this.createLine(1,t);for(let t=0;t<MAX_WIDTH_DIMENSION;t++)for(let e=0;e<MAX_HEIGTH_DIMENSION;e++)this.createSquare(t,e),this.createSquareAux(t,e);this.createCalculated(0),this.createCalculated(1),this.createDecreaseArrow(0),this.createIncreaseArrow(0),this.createDecreaseArrow(1),this.createIncreaseArrow(1),this.createDecreaseArrow(2),this.createIncreaseArrow(2),this.saveState()}maximize(t){this.size+=t||1,this.changeAreaSize()}minimize(t){this.size-=t||1,this.size<1?this.size+=t||1:this.changeAreaSize()}undo(){this.currentKey>0&&(this.currentKey-=1,this.recoverState())}redo(){this.currentKey<this.states.length-1&&(this.currentKey+=1,this.recoverState())}setGridLength(t){t>1&&(this.gridLength=t,this.width=t,this.height=t,this.refreshArea())}setCurrentColor(t){this.currentColor=t}setBackgroundColor(t){let e=this.backgroundColor;this.backgroundColor=t,this.refreshBackground(e)}exportJson(){let t,e,i={colors:[this.backgroundColor],settings:{width:this.width,height:this.height,gridLength:this.gridLength},points:[],horizontalNumbers:[],verticalNumbers:[]};for(let s=0;s<this.height;s++){i.points[s]=[];for(let r=0;r<this.width;r++)t=document.getElementById("square_"+r+"."+s),e=t.getAttribute("fill"),i.colors.includes(e)||i.colors.push(e),i.points[s].push(i.colors.findIndex(t=>t==e))}i.horizontalNumbers=this.getHorizontalNumbers(i),i.verticalNumbers=this.getVerticalNumbers(i),i.settings.horizontalNumbersLength=this.getMaxNumbers(i.horizontalNumbers),i.settings.verticalNumbersLength=this.getMaxNumbers(i.verticalNumbers);var s=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),r=document.createElement("a");r.download="puzzle.json",r.href=window.URL.createObjectURL(s),r.click()}createSvgDocument(){let t=document.getElementById("editor");t.oncontextmenu=function(){return!1};let e=document.createElementNS(SVG_LIB,"svg");e.setAttribute("id","svg"),e.setAttribute("height",this.size*(this.height+3)+TRANSLATE_Y),e.setAttribute("width",this.size*(this.width+3)+TRANSLATE_X);let i="translate("+TRANSLATE_X+","+TRANSLATE_Y+")",s=document.createElementNS(SVG_LIB,"g");s.setAttribute("id","components"),s.setAttribute("transform",i),e.appendChild(s);let r=document.createElementNS(SVG_LIB,"g");r.setAttribute("id","main"),r.setAttribute("transform",i),e.appendChild(r);let h=document.createElementNS(SVG_LIB,"g");h.setAttribute("id","aux"),h.setAttribute("transform",i),e.appendChild(h);let u=document.createElementNS(SVG_LIB,"g");u.setAttribute("id","arrows"),u.setAttribute("transform",i),e.appendChild(u),t.appendChild(e)}createBackground(){let t=document.createElementNS(SVG_LIB,"rect");t.setAttribute("id","background"),t.setAttribute("fill",this.backgroundColor),t.setAttribute("height",this.size*this.height),t.setAttribute("width",this.size*this.width),document.getElementById("components").appendChild(t)}createLine(t,e){let i=document.createElementNS(SVG_LIB,"line");i.setAttribute("id","line_"+t+"."+e),i.setAttribute("stroke",LINE_COLOR),e%this.gridLength==0?i.setAttribute("stroke-width","2"):i.setAttribute("stroke-width","1"),0==t?(i.setAttribute("x1",e*this.size),i.setAttribute("x2",e*this.size),i.setAttribute("y1",0),i.setAttribute("y2",this.height*this.size)):(i.setAttribute("x1",0),i.setAttribute("x2",this.width*this.size),i.setAttribute("y1",e*this.size),i.setAttribute("y2",e*this.size)),document.getElementById("components").appendChild(i)}createSquare(t,e){let i=document.createElementNS(SVG_LIB,"rect");i.setAttribute("id","square_"+t+"."+e),i.setAttribute("height",.95*this.size),i.setAttribute("width",.95*this.size),i.setAttribute("x",t*this.size),i.setAttribute("y",e*this.size),i.setAttribute("stroke",LINE_COLOR),i.setAttribute("fill",this.backgroundColor),i.setAttribute("opacity","0"),document.getElementById("main").appendChild(i)}createSquareAux(t,e){let i=document.createElementNS(SVG_LIB,"rect");i.setAttribute("id","square_aux_"+t+"."+e),i.setAttribute("height",.95*this.size),i.setAttribute("width",.95*this.size),i.setAttribute("x",t*this.size),i.setAttribute("y",e*this.size),i.setAttribute("fill",this.backgroundColor),i.setAttribute("opacity","0"),i.onmouseover=(t=>this.highlightSquare(t)),i.onmouseout=(t=>this.fadeSquare(t)),i.onmousedown=(t=>this.initColorsChange(t)),i.onmousemove=(t=>this.changeColorSquares(t)),document.getElementById("aux").appendChild(i)}createCalculated(t){let e=document.createElementNS(SVG_LIB,"text");e.setAttribute("id","calculated_"+t),e.setAttribute("font-family","serif"),e.setAttribute("font-size",this.size),e.setAttribute("font-weight","bold"),e.setAttribute("fill",CALCULATED_EMPTY_COLOR),0==t?(e.setAttribute("text-anchor","start"),e.setAttribute("x",(this.width+.5)*this.size)):(e.setAttribute("text-anchor","middle"),e.setAttribute("y",(this.height+1)*this.size)),document.getElementById("components").appendChild(e)}createDecreaseArrow(t){let e=document.createElementNS(SVG_LIB,"text");e.setAttribute("id","decrease_arrow_"+t),e.setAttribute("font-size",this.size),e.setAttribute("fill",ARROW_COLOR),e.setAttribute("opacity","0.5"),0==t?(e.setAttribute("text-anchor","end"),e.setAttribute("x",this.width*this.size/2+this.size/2),e.setAttribute("y",this.height*this.size+this.size),e.textContent="ðŸ¢"):1==t?(e.setAttribute("text-anchor","middle"),e.setAttribute("x",this.width*this.size+this.size),e.setAttribute("y",this.height*this.size/2+this.size/4),e.textContent="ðŸ¢€"):(e.setAttribute("text-anchor","middle"),e.setAttribute("x",this.width*this.size+this.size),e.setAttribute("y",this.height*this.size+this.size),e.textContent="ðŸ¢„"),e.onmouseover=(t=>this.highlightDecreaseArrow(t)),e.onmouseout=(t=>this.fadeDecreaseArrow(t)),e.onclick=(t=>this.decreaseSize(t)),document.getElementById("arrows").appendChild(e)}createIncreaseArrow(t){let e=document.createElementNS(SVG_LIB,"text");e.setAttribute("id","increase_arrow_"+t),e.setAttribute("font-size",this.size),e.setAttribute("fill",ARROW_COLOR),e.setAttribute("opacity","0.5"),0==t?(e.setAttribute("text-anchor","end"),e.setAttribute("x",this.width*this.size/2+this.size/2),e.setAttribute("y",this.height*this.size+2*this.size+this.size/4),e.textContent="ðŸ¢ƒ"):1==t?(e.setAttribute("text-anchor","middle"),e.setAttribute("x",this.width*this.size+2*this.size),e.setAttribute("y",this.height*this.size/2+this.size/4),e.textContent="ðŸ¢‚"):(e.setAttribute("text-anchor","middle"),e.setAttribute("x",this.width*this.size+2*this.size-this.size/4),e.setAttribute("y",this.height*this.size+2*this.size-this.size/4),e.textContent="ðŸ¢†"),e.onmouseover=(t=>this.highlightIncreaseArrow(t)),e.onmouseout=(t=>this.fadeIncreaseArrow(t)),e.onclick=(t=>this.increaseSize(t)),document.getElementById("arrows").appendChild(e)}saveState(){for(;this.currentKey<this.states.length-1;)this.states.pop();this.states.push((new XMLSerializer).serializeToString(document.getElementById("main"))),this.states.length>1&&(this.currentKey+=1)}recoverState(){let t=document.getElementById("main");for(;t.firstChild;)t.removeChild(t.firstChild);let e=(new DOMParser).parseFromString(this.states[this.currentKey],"image/svg+xml").documentElement;for(;e.firstChild;)t.appendChild(e.firstChild);this.changeAreaSize(),this.refreshArea()}changeAreaSize(){this.changeSvgDocumentSize(),this.changeBackgroundSize();for(let t=0;t<=this.width;t++)this.changeLineSize(0,t);for(let t=0;t<=this.height;t++)this.changeLineSize(1,t);for(let t=0;t<MAX_WIDTH_DIMENSION;t++)for(let e=0;e<MAX_HEIGTH_DIMENSION;e++)this.changesize(t,e),this.changeSquareAuxSize(t,e);this.changeCalculatedSize(0),this.changeCalculatedSize(1),this.changeDecreaseArrowSize(0),this.changeIncreaseArrowSize(0),this.changeDecreaseArrowSize(1),this.changeIncreaseArrowSize(1),this.changeDecreaseArrowSize(2),this.changeIncreaseArrowSize(2)}changeSvgDocumentSize(){let t=document.getElementById("svg");t.setAttribute("height",this.size*(this.height+3)+TRANSLATE_Y),t.setAttribute("width",this.size*(this.width+3)+TRANSLATE_X)}changeBackgroundSize(){let t=document.getElementById("background");t.setAttribute("height",this.size*this.height),t.setAttribute("width",this.size*this.width)}changeLineSize(t,e){let i=document.getElementById("line_"+t+"."+e);0==t?(i.setAttribute("x1",e*this.size),i.setAttribute("x2",e*this.size),i.setAttribute("y1",0),i.setAttribute("y2",this.height*this.size)):(i.setAttribute("x1",0),i.setAttribute("x2",this.width*this.size),i.setAttribute("y1",e*this.size),i.setAttribute("y2",e*this.size))}changesize(t,e){let i=document.getElementById("square_"+t+"."+e);i.setAttribute("height",.95*this.size),i.setAttribute("width",.95*this.size),i.setAttribute("x",t*this.size),i.setAttribute("y",e*this.size)}changeSquareAuxSize(t,e){let i=document.getElementById("square_aux_"+t+"."+e);i.setAttribute("height",.95*this.size),i.setAttribute("width",.95*this.size),i.setAttribute("x",t*this.size),i.setAttribute("y",e*this.size)}changeCalculatedSize(t){let e=document.getElementById("calculated_"+t);e.setAttribute("font-size",this.size),0==t?e.setAttribute("x",(this.width+.5)*this.size):e.setAttribute("y",(this.height+1)*this.size)}changeDecreaseArrowSize(t){let e=document.getElementById("decrease_arrow_"+t);e.setAttribute("font-size",this.size),0==t?(e.setAttribute("x",this.width*this.size/2+this.size/2),e.setAttribute("y",this.height*this.size+this.size)):1==t?(e.setAttribute("x",this.width*this.size+this.size),e.setAttribute("y",this.height*this.size/2+this.size/4)):(e.setAttribute("x",this.width*this.size+this.size),e.setAttribute("y",this.height*this.size+this.size))}changeIncreaseArrowSize(t){let e=document.getElementById("increase_arrow_"+t);e.setAttribute("font-size",this.size),0==t?(e.setAttribute("x",this.width*this.size/2+this.size/2),e.setAttribute("y",this.height*this.size+2*this.size+this.size/4)):1==t?(e.setAttribute("x",this.width*this.size+2*this.size),e.setAttribute("y",this.height*this.size/2+this.size/4)):(e.setAttribute("x",this.width*this.size+2*this.size-this.size/4),e.setAttribute("y",this.height*this.size+2*this.size-this.size/4))}refreshArea(){this.changeSvgDocumentSize();let t=document.getElementById("components");for(;t.firstChild;)t.removeChild(t.firstChild);this.createBackground();for(let t=0;t<=this.width;t++)this.createLine(0,t);for(let t=0;t<=this.height;t++)this.createLine(1,t);let e=document.getElementById("arrows");for(;e.firstChild;)e.removeChild(e.firstChild);this.createCalculated(0),this.createCalculated(1),this.createDecreaseArrow(0),this.createIncreaseArrow(0),this.createDecreaseArrow(1),this.createIncreaseArrow(1),this.createDecreaseArrow(2),this.createIncreaseArrow(2);for(let t=0;t<MAX_WIDTH_DIMENSION;t++)for(let e=0;e<MAX_HEIGTH_DIMENSION;e++){let i=document.getElementById("square_"+t+"."+e);i.getAttribute("fill")!=this.backgroundColor&&(t>=this.width||e>=this.height?i.setAttribute("opacity","0"):i.setAttribute("opacity","1"))}}refreshCalculatedValues(t,e){if(t<this.width&&e<this.height){let i=document.getElementById("square_"+t+"."+e);this.clicked&&(i=document.getElementById("square_aux_"+t+"."+e));let s,r,h=i.getAttribute("fill"),u=1,o=t+1;for(;o<=this.width-1&&(s=document.getElementById("square_"+o+"."+e),r=document.getElementById("square_aux_"+o+"."+e),s.getAttribute("fill")==h||r.getAttribute("fill")==h&&h!=this.backgroundColor);)o++,u++;let n=t-1;for(;n>=0&&(s=document.getElementById("square_"+n+"."+e),r=document.getElementById("square_aux_"+n+"."+e),s.getAttribute("fill")==h||r.getAttribute("fill")==h&&h!=this.backgroundColor);)n--,u++;let a=1,l=e+1;for(;l<=this.height-1&&(s=document.getElementById("square_"+t+"."+l),r=document.getElementById("square_aux_"+t+"."+l),s.getAttribute("fill")==h||r.getAttribute("fill")==h&&h!=this.backgroundColor);)l++,a++;let d=e-1;for(;d>=0&&(s=document.getElementById("square_"+t+"."+d),r=document.getElementById("square_aux_"+t+"."+d),s.getAttribute("fill")==h||r.getAttribute("fill")==h&&h!=this.backgroundColor);)d--,a++;let c=document.getElementById("calculated_0"),g=document.getElementById("calculated_1");h!=this.backgroundColor?(c.setAttribute("fill",h),g.setAttribute("fill",h)):(c.setAttribute("fill",CALCULATED_EMPTY_COLOR),g.setAttribute("fill",CALCULATED_EMPTY_COLOR)),c.textContent=u,g.textContent=a,c.setAttribute("y",this.size*(e+1)),g.setAttribute("x",this.size*(t+.5))}}cleanAllSquaresAux(){var t;for(let e=0;e<this.width;e++)for(let i=0;i<this.height;i++)"1"==(t=document.getElementById("square_aux_"+e+"."+i)).getAttribute("opacity")&&(t.setAttribute("fill",this.backgroundColor),t.setAttribute("opacity","0"))}refreshSquareAux(t,e){let i=document.getElementById("square_aux_"+t+"."+e),s=document.getElementById("square_"+t+"."+e);if(this.colorSquare==this.backgroundColor)i.setAttribute("fill",this.colorSquare),i.setAttribute("opacity","1");else{s.getAttribute("fill")==this.backgroundColor&&(i.setAttribute("fill",this.colorSquare),i.setAttribute("opacity","1"))}}refreshBackground(t){let e,i;document.getElementById("background").setAttribute("fill",this.backgroundColor);for(let s=0;s<MAX_WIDTH_DIMENSION;s++)for(let r=0;r<MAX_HEIGTH_DIMENSION;r++)(i=document.getElementById("square_aux_"+s+"."+r)).setAttribute("fill",this.backgroundColor),(e=document.getElementById("square_"+s+"."+r)).getAttribute("fill")==t&&e.setAttribute("fill",this.backgroundColor)}getHorizontalNumbers(t){var e,i,s,r=[];for(let e=0;e<t.points.length;e++)r[e]=[];for(let h=0;h<t.points.length;h++){e=0,i=-1,s=!1;for(let u=t.points[0].length-1;u>=0;u--)s?(e++,0!=t.points[h][u]&&t.points[h][u]==i||(0==t.points[h][u]&&(s=!1),r[h].push({number:e,color:i}),e=0)):t.points[h][u]>0&&t.points[h][u]!=i&&(s=!0),i=t.points[h][u];s&&(e++,r[h].push({number:e,color:i}))}return r}getVerticalNumbers(t){var e,i,s,r=[];for(let e=0;e<t.points[0].length;e++)r[e]=[];for(let h=0;h<t.points[0].length;h++){e=0,i=-1,s=!1;for(let u=t.points.length-1;u>=0;u--)s?(e++,0!=t.points[u][h]&&t.points[u][h]==i||(0==t.points[u][h]&&(s=!1),r[h].push({number:e,color:i}),e=0)):t.points[u][h]>0&&t.points[u][h]!=i&&(s=!0),i=t.points[u][h];s&&(e++,r[h].push({number:e,color:i}))}return r}getMaxNumbers(t){var e=0,i=0;for(let s=0;s<t.length;s++)(i=t[s].length)>e&&(e=i);return e}highlightSquare(t){let e=t.target.getAttribute("id"),i=(e=e.replace("square_aux_","")).split("."),s=parseInt(i[0]),r=parseInt(i[1]);if(s<this.width&&r<this.height){let t=document.getElementById("line_0."+s);t.setAttribute("stroke",RULE_COLOR),s%this.gridLength!=0&&t.setAttribute("stroke-width","2"),s+=1,(t=document.getElementById("line_0."+s)).setAttribute("stroke",RULE_COLOR),s%this.gridLength!=0&&t.setAttribute("stroke-width","2");let e=document.getElementById("line_1."+r);e.setAttribute("stroke",RULE_COLOR),r%this.gridLength!=0&&e.setAttribute("stroke-width","2"),r+=1,(e=document.getElementById("line_1."+r)).setAttribute("stroke",RULE_COLOR),r%this.gridLength!=0&&e.setAttribute("stroke-width","2"),document.getElementById("decrease_arrow_0").setAttribute("opacity","0"),document.getElementById("increase_arrow_0").setAttribute("opacity","0"),document.getElementById("decrease_arrow_1").setAttribute("opacity","0"),document.getElementById("increase_arrow_1").setAttribute("opacity","0"),document.getElementById("decrease_arrow_2").setAttribute("opacity","0"),document.getElementById("increase_arrow_2").setAttribute("opacity","0")}}fadeSquare(t){let e=t.target.getAttribute("id"),i=(e=e.replace("square_aux_","")).split("."),s=parseInt(i[0]),r=parseInt(i[1]);if(s<this.width&&r<this.height){let t=document.getElementById("line_0."+s);t.setAttribute("stroke",LINE_COLOR),s%this.gridLength!=0&&t.setAttribute("stroke-width","1"),s+=1,(t=document.getElementById("line_0."+s)).setAttribute("stroke",LINE_COLOR),s%this.gridLength!=0&&t.setAttribute("stroke-width","1");let e=document.getElementById("line_1."+r);e.setAttribute("stroke",LINE_COLOR),r%this.gridLength!=0&&e.setAttribute("stroke-width","1"),r+=1,(e=document.getElementById("line_1."+r)).setAttribute("stroke",LINE_COLOR),r%this.gridLength!=0&&e.setAttribute("stroke-width","1"),document.getElementById("calculated_0").textContent="",document.getElementById("calculated_1").textContent="",document.getElementById("decrease_arrow_0").setAttribute("opacity","0.5"),document.getElementById("increase_arrow_0").setAttribute("opacity","0.5"),document.getElementById("decrease_arrow_1").setAttribute("opacity","0.5"),document.getElementById("increase_arrow_1").setAttribute("opacity","0.5"),document.getElementById("decrease_arrow_2").setAttribute("opacity","0.5"),document.getElementById("increase_arrow_2").setAttribute("opacity","0.5")}}initColorsChange(t){if(0==t.button){let e=t.target.getAttribute("id"),i=(e=e.replace("square_aux_","")).split(".");this.squareI=parseInt(i[0]),this.squareJ=parseInt(i[1]);let s=document.getElementById("square_"+this.squareI+"."+this.squareJ);this.squareI<this.width&&this.squareJ<this.height&&(this.colorSquare=s.getAttribute("fill"),this.colorSquare==this.backgroundColor?(t.target.setAttribute("fill",this.currentColor),t.target.setAttribute("opacity","1"),s.setAttribute("fill",this.currentColor),s.setAttribute("opacity","1"),this.colorSquare=this.currentColor):this.colorSquare==this.currentColor?(t.target.setAttribute("fill",this.backgroundColor),t.target.setAttribute("opacity","0"),s.setAttribute("fill",this.backgroundColor),s.setAttribute("opacity","0"),this.colorSquare=this.backgroundColor):(t.target.setAttribute("fill",this.currentColor),s.setAttribute("fill",this.currentColor),this.colorSquare=this.currentColor),this.clicked=!0,this.refreshCalculatedValues(this.squareI,this.squareJ))}}changeColorSquares(t){let e=t.target.getAttribute("id"),i=(e=e.replace("square_aux_","")).split("."),s=parseInt(i[0]),r=parseInt(i[1]);if(this.clicked){let t;if(this.cleanAllSquaresAux(),s>this.squareI&&r==this.squareJ)for(t=this.squareI;t<=s;)t<this.width&&this.refreshSquareAux(t,this.squareJ),t++;else if(s<this.squareI&&r==this.squareJ)for(t=s;t<=this.squareI;)this.refreshSquareAux(t,this.squareJ),t++;else if(s==this.squareI&&r>this.squareJ)for(t=this.squareJ;t<=r;)t<this.height&&this.refreshSquareAux(this.squareI,t),t++;else if(s==this.squareI&&r<this.squareJ)for(t=r;t<=this.squareJ;)this.refreshSquareAux(this.squareI,t),t++}this.refreshCalculatedValues(s,r)}highlightDecreaseArrow(t){t.target.setAttribute("opacity","1")}fadeDecreaseArrow(t){t.target.setAttribute("opacity","0.5")}decreaseSize(t){let e=t.target.getAttribute("id").replace("decrease_arrow_","");0==e?(this.height-=this.gridLength,this.height<MIN_DIMENSION&&(this.height+=this.gridLength)):1==e?(this.width-=this.gridLength,this.width<MIN_DIMENSION&&(this.width+=this.gridLength)):(this.height-=this.gridLength,this.height<MIN_DIMENSION&&(this.height+=this.gridLength),this.width-=this.gridLength,this.width<MIN_DIMENSION&&(this.width+=this.gridLength)),this.refreshArea()}highlightIncreaseArrow(t){t.target.setAttribute("opacity","1")}fadeIncreaseArrow(t){t.target.setAttribute("opacity","0.5")}increaseSize(t){let e=t.target.getAttribute("id").replace("increase_arrow_","");0==e?(this.height+=this.gridLength,this.height>MAX_HEIGTH_DIMENSION&&(this.height-=this.gridLength)):1==e?(this.width+=this.gridLength,this.width>MAX_WIDTH_DIMENSION&&(this.width-=this.gridLength)):(this.height+=this.gridLength,this.height>MAX_HEIGTH_DIMENSION&&(this.height-=this.gridLength),this.width+=this.gridLength,this.width>MAX_WIDTH_DIMENSION&&(this.width-=this.gridLength)),this.refreshArea()}endColorsChange(){if(this.clicked){let t,e,i,s;for(let r=0;r<this.width;r++)for(let h=0;h<this.height;h++)"1"==(t=document.getElementById("square_aux_"+r+"."+h)).getAttribute("opacity")&&(e=(e=t.getAttribute("id")).replace("square_aux_","square_"),i=document.getElementById(e),s=t.getAttribute("fill"),i.setAttribute("fill",s),s==this.backgroundColor?i.setAttribute("opacity","0"):i.setAttribute("opacity","1"),t.setAttribute("fill",this.backgroundColor),t.setAttribute("opacity","0"));this.clicked=!1,this.saveState()}}}